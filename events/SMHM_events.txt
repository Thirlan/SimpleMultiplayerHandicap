namespace = smhm

# Send every player, Test your might event
event = {
	id = smhm.1
	hide_window = yes

	is_triggered_only = yes
    
    immediate = {
        every_playable_country = {
            limit = {
                is_ai = no
            }
            country_event = {
                id = smhm.2
            }
        }
    }
}

# Test your might
country_event = {
	id = smhm.2
	title = smhm.2.name
	desc = smhm.2.desc
	
	picture = GFX_evt_gladiators
	show_sound = event_default
	
	is_triggered_only = yes
	
	immediate = {
		owner = {
			country_event = {
				id = smhm.3 days = 60
			}
		}
	}

	option = {
		name = smhm.2.a
        add_modifier = {
            modifier = weak_handicap
            days = -1
        }
        save_event_target_as = smhm_handicap_country
		every_playable_country = {
            country_event = {
                id = smhm.4
            }
        }
	}
	option = {
		name = smhm.2.b
	}
	option = {
		name = smhm.2.c
        add_modifier = {
            modifier = strong_handicap
            days = -1
        }
        save_event_target_as = smhm_handicap_country
        every_playable_country = {
            country_event = {
                id = smhm.4
            }
        }
	}
}

# Confirm your might
country_event = {
	id = smhm.3
	title = smhm.3.name

	desc = {
		text = smhm.3.desc_01
		trigger = {
			 has_modifier = weak_handicap
		}
	}
	
	desc = {
		text = smhm.3.desc_02
		trigger = {
			 has_modifier = strong_handicap
		}
	}
	
	picture = GFX_evt_gladiators
	show_sound = event_default
	
	is_triggered_only = yes

	option = {
		name = smhm.3.a
	}

	option = {
		name = smhm.3.b
		remove_modifier = weak_handicap
        remove_modifier = strong_handicap
	}
}

# Declare your might
country_event = {
	id = smhm.4
	title = smhm.4.name

	desc = {
		text = smhm.4.desc_01
		trigger = {
			event_target:smhm_handicap_country = {
                has_modifier = weak_handicap
            }
		}
	}
	
	desc = {
		text = smhm.4.desc_02
		trigger = {
            event_target:smhm_handicap_country = {
                has_modifier = strong_handicap
            }
		}
	}
	
	picture = GFX_evt_alien_propaganda
	show_sound = event_default
	
	is_triggered_only = yes

	option = {
		name = smhm.4.a
	}
}

# Winner/Loser start
event = {
	id = smhm.5
	hide_window = yes

	is_triggered_only = yes
    
	immediate = {
		random_playable_country = {
            limit = {
                is_ai = no
            }

            save_event_target_as = smhm_strongest_country
            save_event_target_as = smhm_weakest_country
            remove_modifier = blessing_of_the_underdog
            remove_modifier = icarus_curse
            
            every_playable_country = {
                limit = {
                    is_ai = no
                }
            
                remove_modifier = blessing_of_the_underdog
                remove_modifier = icarus_curse
                if = {
                    limit = {
                        relative_power = {
                            who = event_target:smhm_strongest_country
                            category = all
                            value > equivalent
                        }
                    }
                    log = "[owner.GetName] is stronger than [smhm_strongest_country.GetName]"
                    save_event_target_as = smhm_strongest_country
                }
                
                if = {
                    limit = {
                        relative_power = {
                            who = event_target:smhm_weakest_country
                            category = all
                            value < equivalent
                        }
                    }
                    log = "[owner.GetName] is weaker than [smhm_weakest_country.GetName]"
                    save_event_target_as = smhm_weakest_country
                }
            }
            
            event_target:smhm_weakest_country = {
                if = {
                    limit = {
                        NOT = {
                            is_same_empire = event_target:smhm_strongest_country
                        }
                    }
                    country_event = {
                        id = smhm.6
                    }
                }
            }
            
            event_target:smhm_strongest_country = {
                if = {
                    limit = {
                        NOT = {
                            is_same_empire = event_target:smhm_weakest_country
                        }
                    }
                    country_event = {
                        id = smhm.7
                    }
                }
            }
		}
	}
}

# Blessings of the Underdog
country_event = {
	id = smhm.6
	title = smhm.6.name
	desc = smhm.6.desc
	
	picture = GFX_evt_open_revolt
	show_sound = event_default
	
	is_triggered_only = yes
    
    immediate = {
        log = "New Weakest [owner.GetName]"
    }

	option = {
		name = smhm.6.a
        add_modifier = {
            modifier = blessing_of_the_underdog
            days = -1
        }
	}
}

# Icarus' curse
country_event = {
	id = smhm.7
	title = smhm.7.name
	desc = smhm.7.desc
	
	picture = GFX_evt_atmospheric_flight
	show_sound = event_default
	
	is_triggered_only = yes

    immediate = {
        log = "New Strongest [owner.GetName]"
    }

	option = {
		name = smhm.7.a
        add_modifier = {
            modifier = icarus_curse
            days = -1
        }
	}
}

